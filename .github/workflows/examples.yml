name: Examples

on:
    push:
        branches: [ "main" ]
    pull_request:
        branches: [ "**" ]
        types: [ opened, synchronize, reopened, ready_for_review ]
    workflow_dispatch:

jobs:
    validate-examples:
        name: Validate Examples (PHP ${{ matrix.php-version }})
        runs-on: ubuntu-latest
        strategy:
            fail-fast: false
            matrix:
                php-version: [ '8.2', '8.3', '8.4' ]

        steps:
            -   name: Checkout repository
                uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

            -   name: Install dependencies
                uses: ./.github/actions/composer-install
                with:
                    php-version: ${{ matrix.php-version }}
                    ini_values: 'memory_limit=-1'

            -   name: Validate example syntax
                run: |
                    echo "Validating PHP syntax for all examples..."
                    for example in examples/*.php; do
                      echo "Checking $example..."
                      php -l "$example"
                    done

            -   name: Run composer examples
                run: |
                    echo "Testing composer examples script..."
                    timeout 180s composer examples
                    echo "âœ“ All examples ran successfully via composer"