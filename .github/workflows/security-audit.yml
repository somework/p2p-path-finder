name: Security Audit

on:
    schedule:
        -   cron: '0 6 * * 1'
    push:
        branches: [ "main" ]
    pull_request:
        branches: [ "**" ]
        types: [ opened, synchronize, reopened, ready_for_review ]
    workflow_dispatch:

permissions:
    contents: read

jobs:
    composer-audit:
        name: Composer Audit
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout repository
                uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

            -   name: Install dependencies
                uses: ./.github/actions/composer-install
                with:
                    php-version: '8.3'

            -   name: Run Composer security audit
                run: composer audit --abandoned=report
