# 0003.1: Grep Audit - Float Literals in Arithmetic

**Parent Task**: [0003 - Decimal Arithmetic Consistency Audit](../0003-high-priority-decimal-arithmetic-consistency-audit.md)  
**Effort**: S (1 hour)  
**Priority**: P1 - Release-blocking  
**Dependencies**: None

## Description

Search the entire codebase for float literals used in arithmetic operations. Float arithmetic can introduce precision errors and non-determinism. All arithmetic should use BigDecimal.

## Actions

1. Run grep searches:
   ```bash
   # Search for float literals in arithmetic contexts
   grep -rn '\d\+\.\d\+\s*[\+\-\*/]' src/ --include="*.php"
   grep -rn '[\+\-\*/]\s*\d\+\.\d\+' src/ --include="*.php"
   
   # Also check tests for bad patterns
   grep -rn '\d\+\.\d\+\s*[\+\-\*/]' tests/ --include="*.php" | head -20
   ```

2. For each finding:
   - Determine if legitimate (constants, non-arithmetic use)
   - Identify problematic uses (actual arithmetic)
   - Note location and context

3. Create findings document:
   - List all float literal usages
   - Categorize: LEGITIMATE vs PROBLEMATIC
   - For PROBLEMATIC: note what needs fixing

4. Create GitHub issues for fixes (if needed)

## Acceptance Criteria

- [ ] Grep search completed for `src/` directory
- [ ] All findings documented with:
  - File path and line number
  - Code snippet showing usage
  - Context (why is float used?)
  - Category: LEGITIMATE or PROBLEMATIC
- [ ] Legitimate uses justified:
  - Constants (e.g., `const PI = 3.14159`)
  - Test mocks
  - Non-arithmetic contexts
- [ ] Problematic uses identified:
  - Float arithmetic that should use BigDecimal
  - Comparisons using float literals
- [ ] Findings document created: `docs/audits/float-literals-audit.md`

## Definition of Done

- [ ] Grep search completed
- [ ] All float literals in src/ documented
- [ ] `docs/audits/float-literals-audit.md` created
- [ ] Problematic uses documented with fix plan
- [ ] If NO problematic uses found: Document "No issues found"
- [ ] Sample of tests checked (tests may use floats in mocks - acceptable)

## Tests Needed

No new tests for this audit task.

Tests will be added when fixing any identified issues.

## Example Findings Document

```markdown
# Float Literals Audit - 2025-11-22

## Summary

- **Total findings**: 3
- **Legitimate uses**: 2
- **Problematic uses**: 1
- **Recommendation**: Fix 1 problematic use

## Findings

### LEGITIMATE Uses

#### 1. Test Mock (tests/PathFinderTest.php:123)
```php
$mockRate = 1.5; // Used in test double
```
**Justification**: Test mock, not production arithmetic.  
**Action**: None

#### 2. Documentation Comment (src/Domain/ValueObject/Money.php:45)
```php
// Example: 10.50 represents ten dollars and fifty cents
```
**Justification**: Comment example only.  
**Action**: None

### PROBLEMATIC Uses

#### 1. Arithmetic Operation (src/Application/Service/Helper.php:67)
```php
$result = $amount * 1.05; // 5% markup
```
**Issue**: Float multiplication can lose precision.  
**Fix Required**: Use BigDecimal
```php
$result = $amount->multipliedBy(BigDecimal::of('1.05'));
```
**Priority**: High  
**Estimated effort**: 15 minutes

## Recommendations

1. Fix Helper.php:67 to use BigDecimal
2. Add PHPStan rule to detect float arithmetic (Task 0003.12)
3. Re-audit after fixing to ensure no new float arithmetic
```

## Notes

- This is a quick audit task (1 hour max)
- Most findings are likely legitimate (test mocks, comments)
- Even one problematic use is worth fixing for determinism
- Document everything, even if "no issues found"

