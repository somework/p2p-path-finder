# 0001.3: Review Value Object Exposure in Internal Types

**Parent Task**: [0001 - Public API Surface Finalization](../0001-high-priority-public-api-finalization.md)  
**Effort**: S (1-2 hours)  
**Priority**: P1 - Release-blocking  
**Dependencies**: 0001.1 (Public API Inventory)

## Description

`CandidatePath` and `SpendConstraints` are internal types but are exposed through callback signatures in `PathFinderService::findBestPaths()`. Determine if this exposure is intentional and document the decision.

## Actions

1. Review `CandidatePath` usage:
   - Where is it exposed? (acceptance callback signature)
   - What information does it provide to consumers?
   - Can callback work without it?
2. Review `SpendConstraints` usage:
   - Is it accessible through `CandidatePath`?
   - Does consumer code need it?
3. Make decision for each:
   - **Keep as public**: Add to api-stability.md, document, add examples
   - **Make truly internal**: Refactor callback to not expose it
   - **Accept exposure**: Document as "implementation detail in callback"
4. Update `docs/api-stability.md`

## Acceptance Criteria

- [x] `CandidatePath` exposure analyzed
- [x] `SpendConstraints` exposure analyzed
- [x] Decision made for each with rationale
- [x] If keeping public:
  - Added to PUBLIC section of api-stability.md
  - PHPDoc complete
  - Usage examples provided
- [x] If making internal:
  - Plan for refactoring documented (may be separate task)
  - Breaking change noted
- [x] If accepting exposure:
  - Documented in INTERNAL section with note about callback exposure

## Definition of Done

- [x] Analysis documented for both classes
- [x] Decision made and recorded in api-stability.md
- [x] PHPDoc updated on both classes
- [x] If public: Usage documented
- [x] All tests pass
- [x] PHPStan/Psalm pass

## Tests Needed

No new tests required for analysis/documentation.

If making public:
- [ ] Add tests demonstrating consumer usage of exposed types
- [ ] Add to integration test suite

## Example Documentation

### If Public

```markdown
## Public API

### Callback Value Objects

- `SomeWork\P2PPathFinder\Application\PathFinder\ValueObject\CandidatePath`
  - Purpose: Represents a candidate path in acceptance callback
  - Exposed through: `PathFinderService::findBestPaths()` callback
  - Properties: cost, hops, edges, spend constraints
  - Usage: Check candidate properties before accepting path
```

### If Internal

```markdown
## Internal API

- `CandidatePath` - Internal representation of search candidates
  - Note: Exposed in callback signature but considered implementation detail
  - Consumers should not depend on its structure
  - May change in future versions
```

## Notes

- This affects the public API contract
- If made truly public, needs full documentation
- Current exposure might be acceptable if documented as "opaque callback parameter"

