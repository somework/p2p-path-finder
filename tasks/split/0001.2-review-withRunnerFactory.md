# 0001.2: Review PathFinderService::withRunnerFactory()

**Parent Task**: [0001 - Public API Surface Finalization](../0001-high-priority-public-api-finalization.md)  
**Effort**: S (1 hour)  
**Priority**: P1 - Release-blocking  
**Dependencies**: 0001.1 (Public API Inventory)

## Description

The `PathFinderService::withRunnerFactory()` method is marked `@internal` but is public, creating ambiguity about whether it's part of the supported API or test-only. Review usage and decide on proper classification.

## Actions

1. Search codebase for all usages of `withRunnerFactory()`:
   ```bash
   grep -r "withRunnerFactory" --include="*.php"
   ```
2. Analyze usage patterns:
   - Is it used in production code?
   - Is it only in tests?
   - What's the use case?
3. Make decision:
   - **Option A**: Test-only → Document as @internal test utility
   - **Option B**: Needed by consumers → Make it properly public
   - **Option C**: Not needed → Remove or make private
4. Update PHPDoc accordingly
5. Update `docs/api-stability.md` with decision

## Acceptance Criteria

- [x] All usages of `withRunnerFactory()` identified and analyzed
- [x] Decision made with clear rationale
- [x] Decision documented in `docs/api-stability.md`
- [x] PHPDoc updated to reflect decision
- [x] If test-only: Clear comment states "FOR TESTING ONLY - NOT PART OF PUBLIC API"
- [x] If public: Document use cases and provide example

## Definition of Done

- [x] Usage search completed
- [x] Decision made and documented
- [x] PHPDoc updated with:
  - @internal tag if test-only
  - Or clear documentation if public
  - Explanation of when to use
- [x] `docs/api-stability.md` updated with decision
- [x] All tests still pass
- [x] PHPStan/Psalm pass

## Tests Needed

If made properly public:
- [ ] Add example test showing legitimate usage
- [ ] Add to PathFinderServiceTest.php

If kept internal:
- [x] Verify existing tests still work
- [x] No new tests needed

## Example Documentation

### If Test-Only

```php
/**
 * Factory hook for testing. NOT PART OF PUBLIC API.
 * 
 * This method exists solely to enable testing of PathFinderService
 * with mock PathFinder implementations. Production code should never
 * use this method.
 * 
 * @internal This is for testing only and may change without notice
 */
public static function withRunnerFactory(
    GraphBuilder $graphBuilder,
    ?PathOrderStrategy $orderingStrategy,
    Closure $pathFinderFactory,
): self
```

### If Public

```php
/**
 * Advanced factory for custom PathFinder implementations.
 * 
 * Allows injection of a custom PathFinder factory for specialized
 * search algorithms. Most consumers should use the default constructor.
 * 
 * @param Closure(PathSearchRequest):Closure(...):SearchOutcome $pathFinderFactory
 * 
 * @example
 * $service = PathFinderService::withRunnerFactory(
 *     $graphBuilder,
 *     $customStrategy,
 *     fn($request) => fn($graph, $callback) => new CustomPathFinder(...)
 * );
 */
```

## Notes

- Quick decision task but important for API clarity
- Depends on 0001.1 inventory to understand context
- Most likely outcome: document as test-only internal method

